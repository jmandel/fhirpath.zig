{
  "_spec_summary": [
    "BOUNDARY AND PRECISION FUNCTIONS - Functions for working with value precision and bounds.",
    "All these functions are STU (Standard for Trial Use).",
    "",
    "=== precision() : Integer ===",
    "Returns the number of digits of precision in the input value.",
    "Can ONLY be used with Decimal, Date, DateTime, and Time values.",
    "NOTE: Integer is NOT a valid input type per spec!",
    "",
    "For Decimal: returns digits after the decimal point in the literal.",
    "  1.58700.precision() \u2192 5 (counts trailing zeros from the literal)",
    "  1.5.precision() \u2192 1",
    "",
    "For Date: returns precision based on components present.",
    "  Precision levels for Date:",
    "    Year only (@2014) \u2192 4",
    "    Year-Month (@2014-01) \u2192 6",
    "    Year-Month-Day (@2014-01-01) \u2192 8",
    "",
    "For DateTime: extends Date precision with time components.",
    "  Precision levels for DateTime:",
    "    ...to hours (@2014-01-01T10) \u2192 10",
    "    ...to minutes (@2014-01-01T10:30) \u2192 12",
    "    ...to seconds (@2014-01-01T10:30:00) \u2192 14",
    "    ...to milliseconds (@2014-01-01T10:30:00.000) \u2192 17",
    "",
    "For Time: same pattern as DateTime time portion.",
    "  @T10:30.precision() \u2192 4",
    "  @T10:30:00.000.precision() \u2192 9",
    "",
    "Empty input \u2192 empty result.",
    "Multiple items \u2192 error.",
    "",
    "=== lowBoundary([precision: Integer]) : Decimal | Date | DateTime | Time ===",
    "Returns the least possible value of the input to the specified precision.",
    "",
    "For Decimal: calculates the lower bound based on uncertainty.",
    "  The uncertainty is \u00b10.5 at the last digit of precision.",
    "  OUTPUT ALWAYS HAS type=decimal, even for precision=0!",
    "  Trailing zeros are significant and preserved in output.",
    "",
    "  Spec examples:",
    "  1.587.lowBoundary() \u2192 1.58650000 (default is 8 digits precision)",
    "  1.587.lowBoundary(6) \u2192 1.586500",
    "  1.587.lowBoundary(2) \u2192 1.58",
    "  1.587.lowBoundary(0) \u2192 1 (still type=decimal, not integer)",
    "",
    "  For negative decimals, lowBoundary goes more negative:",
    "  (-1.587).lowBoundary() \u2192 -1.58750000",
    "  (-1.587).lowBoundary(2) \u2192 -1.59",
    "",
    "  Integer-valued decimals (note: NOT Integer type, but integers used as decimals):",
    "  1.lowBoundary(0) \u2192 0 (meaning 0.5 to 1.5, lower bound is 0.5 \u2192 rounds to 0)",
    "  1.lowBoundary(5) \u2192 0.50000",
    "",
    "For Date/DateTime: fills unknown components with minimum values.",
    "  @2014.lowBoundary(6) \u2192 @2014-01 (year expands to include month)",
    "  @2014-01-01T08.lowBoundary(17) \u2192 @2014-01-01T08:00:00.000+14:00",
    "  Note: +14:00 is the earliest timezone offset when not specified.",
    "",
    "For Time: fills unknown components with minimum values.",
    "  @T10:30.lowBoundary(9) \u2192 @T10:30:00.000",
    "",
    "For Quantity: applies to the numeric value, preserves unit.",
    "  1.587 'cm'.lowBoundary(8) \u2192 1.5865 'cm' (type=Quantity)",
    "",
    "If precision > implementation max, result is empty.",
    "If precision is negative, result is empty.",
    "Empty input \u2192 empty result.",
    "Multiple items \u2192 error.",
    "",
    "=== highBoundary([precision: Integer]) : Decimal | Date | DateTime | Time ===",
    "Returns the greatest possible value of the input to the specified precision.",
    "",
    "For Decimal: calculates the upper bound based on uncertainty.",
    "  1.587.highBoundary() \u2192 1.58750000",
    "  1.587.highBoundary(6) \u2192 1.587500",
    "  1.587.highBoundary(2) \u2192 1.59",
    "  1.587.highBoundary(0) \u2192 2",
    "",
    "  For negative decimals, highBoundary goes less negative:",
    "  (-1.587).highBoundary() \u2192 -1.58650000",
    "  (-1.587).highBoundary(2) \u2192 -1.58",
    "",
    "For Date/DateTime: fills unknown components with maximum values.",
    "  @2014.highBoundary(6) \u2192 @2014-12",
    "  @2014-01-01T08.highBoundary(17) \u2192 @2014-01-01T08:59:59.999-12:00 (per SPEC)",
    "  Note: -12:00 is the latest timezone offset when not specified.",
    "",
    "  IMPORTANT DISCREPANCY: Official tests show 08:00:59.999 but spec shows 08:59:59.999",
    "  Spec says: @2014-01-01T08.highBoundary(17) // @2014-01-01T08:59:59.999",
    "  Official tests say: 2014-01-01T08:00:59.999-12:00",
    "  We follow the SPEC (08:59:59.999) since it makes semantic sense:",
    "  Input hour=08 means interval [08:00:00.000, 09:00:00.000)",
    "  highBoundary should be the maximum instant: 08:59:59.999",
    "",
    "For Time: fills unknown components with maximum values.",
    "  @T10:30.highBoundary(9) \u2192 @T10:30:59.999",
    "",
    "For Quantity: applies to the numeric value, preserves unit.",
    "  1.587 'm'.highBoundary(8) \u2192 1.5875 'm'",
    "",
    "If precision > implementation max, result is empty.",
    "Empty input \u2192 empty result.",
    "Multiple items \u2192 error.",
    "",
    "=== Key precision values ===",
    "Default/max precision by type:",
    "  Decimal: at least 8 digits after decimal",
    "  Date: 4 (year only) to 8 (full date)",
    "  DateTime: at least 17 (to milliseconds with timezone)",
    "  Time: at least 9 (to milliseconds)",
    "",
    "=== Implementation note on uncertainty ===",
    "The boundary functions model measurement uncertainty:",
    "  - A value like 1.587 represents the interval [1.5865, 1.5875)",
    "  - lowBoundary gives the closed lower bound",
    "  - highBoundary gives the open upper bound (or supremum)",
    "This is critical for correct date/time comparisons under partial precision.",
    "",
    "=== Parsing note ===",
    "-120.highBoundary(2) parses as -(120.highBoundary(2)) = -120.50",
    "(-120).highBoundary(2) parses as highBoundary on -120 = -119.50"
  ],
  "_todo": [
    "[ ] Improve passing rate (0/65 passing)",
    "[ ] Parser may need to support negative decimal literals like (-1.587)",
    "[ ] Verify timezone handling for DateTime boundaries (+14:00 and -12:00)",
    "[ ] Test interaction with Quantity type",
    "[ ] Open question: should precision(39) fail for Decimal or return empty? (spec says empty)",
    "[x] Verified return type is always decimal for boundary functions, even at precision=0",
    "[x] Verified trailing zeros are significant in decimal output",
    "[x] Documented spec vs official test discrepancy for highBoundary DateTime minutes"
  ],
  "meta": {
    "status": "reviewed"
  },
  "cases": [
    {
      "_comment": "=== precision() function ===",
      "name": "precision_decimal_trailing_zeros",
      "expr": "1.58700.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 5
        }
      ]
    },
    {
      "name": "precision_decimal_simple",
      "expr": "1.5.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 1
        }
      ]
    },
    {
      "name": "precision_decimal_many_digits",
      "expr": "3.14159265.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 8
        }
      ]
    },
    {
      "name": "precision_date_year",
      "expr": "@2014.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 4
        }
      ]
    },
    {
      "name": "precision_date_month",
      "expr": "@2014-01.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 6
        }
      ]
    },
    {
      "name": "precision_date_day",
      "expr": "@2014-01-05.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 8
        }
      ]
    },
    {
      "name": "precision_datetime_hours",
      "expr": "@2014-01-05T10.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 10
        }
      ]
    },
    {
      "name": "precision_datetime_minutes",
      "expr": "@2014-01-05T10:30.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 12
        }
      ]
    },
    {
      "name": "precision_datetime_seconds",
      "expr": "@2014-01-05T10:30:00.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 14
        }
      ]
    },
    {
      "name": "precision_datetime_milliseconds",
      "expr": "@2014-01-05T10:30:00.000.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 17
        }
      ]
    },
    {
      "name": "precision_time_minutes",
      "expr": "@T10:30.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 4
        }
      ]
    },
    {
      "name": "precision_time_seconds",
      "expr": "@T10:30:00.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 6
        }
      ]
    },
    {
      "name": "precision_time_milliseconds",
      "expr": "@T10:30:00.000.precision()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 9
        }
      ]
    },
    {
      "name": "precision_empty_input",
      "expr": "{}.precision()",
      "input": {},
      "expect": []
    },
    {
      "_comment": "=== lowBoundary() for Decimal ===",
      "name": "lowBoundary_decimal_default",
      "expr": "1.587.lowBoundary()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.58650000"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_precision_6",
      "expr": "1.587.lowBoundary(6)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.586500"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_precision_2",
      "expr": "1.587.lowBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.58"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_precision_0",
      "expr": "1.587.lowBoundary(0)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_negative",
      "expr": "(-1.587).lowBoundary()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-1.58750000"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_negative_precision_6",
      "expr": "(-1.587).lowBoundary(6)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-1.587500"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_negative_precision_2",
      "expr": "(-1.587).lowBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-1.59"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_negative_precision_0",
      "expr": "(-1.587).lowBoundary(0)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-2"
        }
      ]
    },
    {
      "name": "lowBoundary_integer_precision_0",
      "expr": "1.lowBoundary(0)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "0"
        }
      ]
    },
    {
      "name": "lowBoundary_integer_precision_5",
      "expr": "1.lowBoundary(5)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "0.50000"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_12_587_precision_2",
      "expr": "12.587.lowBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "12.58"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_12_500_precision_4",
      "expr": "12.500.lowBoundary(4)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "12.4995"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_120_precision_2",
      "expr": "120.lowBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "119.50"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_neg120_precision_2",
      "expr": "(-120).lowBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-120.50"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_small_precision_1",
      "expr": "0.0034.lowBoundary(1)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "0.0"
        }
      ]
    },
    {
      "name": "lowBoundary_decimal_small_negative_precision_1",
      "expr": "(-0.0034).lowBoundary(1)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-0.0"
        }
      ],
      "_comment": "Spec: (-0.0034).lowBoundary(1) = -0.0 (negative zero)"
    },
    {
      "name": "lowBoundary_decimal_negative_precision",
      "expr": "1.587.lowBoundary(-1)",
      "input": {},
      "expect": []
    },
    {
      "name": "lowBoundary_decimal_precision_too_high",
      "expr": "1.587.lowBoundary(39)",
      "input": {},
      "expect": []
    },
    {
      "name": "lowBoundary_empty_input",
      "expr": "{}.lowBoundary()",
      "input": {},
      "expect": []
    },
    {
      "_comment": "=== highBoundary() for Decimal ===",
      "name": "highBoundary_decimal_default",
      "expr": "1.587.highBoundary()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.58750000"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_precision_6",
      "expr": "1.587.highBoundary(6)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.587500"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_precision_2",
      "expr": "1.587.highBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.59"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_precision_0",
      "expr": "1.587.highBoundary(0)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "2"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_negative",
      "expr": "(-1.587).highBoundary()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-1.58650000"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_negative_precision_6",
      "expr": "(-1.587).highBoundary(6)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-1.586500"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_negative_precision_2",
      "expr": "(-1.587).highBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-1.58"
        }
      ]
    },
    {
      "name": "highBoundary_integer_default",
      "expr": "1.highBoundary()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.50000000"
        }
      ]
    },
    {
      "name": "highBoundary_integer_precision_0",
      "expr": "1.highBoundary(0)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "2"
        }
      ]
    },
    {
      "name": "highBoundary_integer_precision_5",
      "expr": "1.highBoundary(5)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "1.50000"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_12_587_precision_2",
      "expr": "12.587.highBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "12.59"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_12_500_precision_4",
      "expr": "12.500.highBoundary(4)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "12.5005"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_120_precision_2",
      "expr": "120.highBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "120.50"
        }
      ]
    },
    {
      "name": "highBoundary_decimal_neg120_precision_2",
      "expr": "(-120).highBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-119.50"
        }
      ],
      "_comment": "Negative: greatest value in [-120.5, -119.5) is -119.5"
    },
    {
      "name": "highBoundary_decimal_neg_unary_minus",
      "expr": "-120.highBoundary(2)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "-120.5"
        }
      ],
      "_comment": "Parses as -(120.highBoundary(2)) = -120.50"
    },
    {
      "name": "highBoundary_decimal_small_precision_1",
      "expr": "0.0034.highBoundary(1)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "0.0"
        }
      ],
      "_comment": "0.0034 rounded to 1 decimal is 0.0 (highBoundary \u2248 0.05)"
    },
    {
      "name": "highBoundary_decimal_small_negative_precision_1",
      "expr": "(-0.0034).highBoundary(1)",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": "0.0"
        }
      ],
      "_comment": "-0.0034 highBoundary at precision 1 is 0.0"
    },
    {
      "name": "highBoundary_decimal_negative_precision",
      "expr": "1.587.highBoundary(-1)",
      "input": {},
      "expect": []
    },
    {
      "name": "highBoundary_decimal_precision_too_high",
      "expr": "1.587.highBoundary(39)",
      "input": {},
      "expect": []
    },
    {
      "name": "highBoundary_empty_input",
      "expr": "{}.highBoundary()",
      "input": {},
      "expect": []
    },
    {
      "_comment": "=== lowBoundary() for Date/DateTime ===",
      "name": "lowBoundary_date_to_month",
      "expr": "@2014.lowBoundary(6)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-01"
        }
      ]
    },
    {
      "name": "lowBoundary_datetime_to_ms",
      "expr": "@2014-01-01T08.lowBoundary(17)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-01-01T08:00:00.000+14:00"
        }
      ]
    },
    {
      "name": "lowBoundary_datetime_with_tz",
      "expr": "@2014-01-01T08:05+08:00.lowBoundary(17)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-01-01T08:05:00.000+08:00"
        }
      ]
    },
    {
      "name": "lowBoundary_datetime_to_day",
      "expr": "@2014-01-01T08.lowBoundary(8)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-01-01"
        }
      ]
    },
    {
      "name": "lowBoundary_time_to_ms",
      "expr": "@T10:30.lowBoundary(9)",
      "input": {},
      "expect": [
        {
          "type": "time",
          "value": "10:30:00.000"
        }
      ]
    },
    {
      "_comment": "=== highBoundary() for Date/DateTime ===",
      "name": "highBoundary_date_to_month",
      "expr": "@2014.highBoundary(6)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-12"
        }
      ]
    },
    {
      "name": "highBoundary_datetime_to_ms",
      "expr": "@2014-01-01T08.highBoundary(17)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-01-01T08:59:59.999-12:00"
        }
      ],
      "_spec_vs_official": {
        "spec_says": "2014-01-01T08:59:59.999",
        "official_says": "2014-01-01T08:00:59.999-12:00",
        "we_follow": "spec",
        "reason": "Input hour=08 means interval [08:00:00, 09:00:00). Max instant is 08:59:59.999"
      }
    },
    {
      "name": "highBoundary_datetime_with_tz",
      "expr": "@2014-01-01T08:05-05:00.highBoundary(17)",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2014-01-01T08:05:59.999-05:00"
        }
      ]
    },
    {
      "name": "highBoundary_time_to_ms",
      "expr": "@T10:30.highBoundary(9)",
      "input": {},
      "expect": [
        {
          "type": "time",
          "value": "10:30:59.999"
        }
      ]
    },
    {
      "_comment": "=== lowBoundary/highBoundary with Quantity - preserves unit ===",
      "name": "lowBoundary_quantity",
      "expr": "1.587 'cm'.lowBoundary(8)",
      "input": {},
      "expect": [
        {
          "type": "Quantity",
          "value": {
            "value": 1.5865,
            "unit": "cm"
          }
        }
      ]
    },
    {
      "name": "highBoundary_quantity",
      "expr": "1.587 'm'.highBoundary(8)",
      "input": {},
      "expect": [
        {
          "type": "Quantity",
          "value": {
            "value": 1.5875,
            "unit": "m"
          }
        }
      ]
    }
  ]
}
