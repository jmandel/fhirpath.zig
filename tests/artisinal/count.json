{
  "meta": {
    "status": "implemented",
    "feature": "count",
    "source": "spec/index.md#count() : Integer"
  },
  "spec": {
    "summary": [
      "count() returns the integer number of items in the input collection.",
      "If the input collection is empty, count() returns 0.",
      "count() reflects collection semantics and does not remove duplicates."
    ],
    "examples": [
      "Patient.name.given.count()"
    ]
  },
  "todo": [
    "[x] Implement parsing of count() function calls.",
    "[x] Implement count() evaluation to return the number of items in the input collection.",
    "[x] Confirm count() on scalar values follows singleton collection semantics.",
    "[x] Improve passing rate (5/5 passing)."
  ],
  "cases": [
    {
      "name": "count on missing field returns 0",
      "expr": "name.count()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 0
        }
      ]
    },
    {
      "name": "count on empty array returns 0",
      "expr": "name.count()",
      "input": {
        "name": []
      },
      "expect": [
        {
          "type": "integer",
          "value": 0
        }
      ]
    },
    {
      "name": "count on scalar returns 1",
      "expr": "active.count()",
      "input": {
        "active": false
      },
      "expect": [
        {
          "type": "integer",
          "value": 1
        }
      ]
    },
    {
      "name": "count includes duplicate items",
      "expr": "given.count()",
      "input": {
        "given": [
          "Ann",
          "Ann",
          "Bob"
        ]
      },
      "expect": [
        {
          "type": "integer",
          "value": 3
        }
      ]
    },
    {
      "name": "count on nested path flattens across items",
      "expr": "name.given.count()",
      "input": {
        "name": [
          {
            "given": [
              "Ann",
              "Annie"
            ]
          },
          {
            "given": [
              "Bob"
            ]
          }
        ]
      },
      "expect": [
        {
          "type": "integer",
          "value": 3
        }
      ]
    }
  ]
}
