{
  "_spec_summary": [
    "Integer Division (div) and Modulo (mod) Operators",
    "",
    "=== div (Truncated Division) ===",
    "Performs truncated division of left operand by right operand.",
    "- Supported for Integer and Decimal operands",
    "- Result is always Integer for integer inputs, Decimal for decimal inputs",
    "- 'Truncated' means the fractional part is discarded (toward zero, NOT floor)",
    "- Division by zero returns empty collection ({}), NOT an error",
    "- Empty operands return empty collection",
    "",
    "Examples from spec:",
    "  5 div 2 = 2 (not 2.5, truncated)",
    "  5.5 div 0.7 = 7 (5.5/0.7 = 7.857..., truncated to 7)",
    "  5 div 0 = {} (empty, not error)",
    "",
    "=== mod (Modulo/Remainder) ===",
    "Computes the remainder of truncated division.",
    "- Supported for Integer and Decimal operands",
    "- Result type matches operand types",
    "- Definition: a mod b = a - (a div b) * b",
    "- Modulo by zero returns empty collection ({}), NOT an error",
    "- Empty operands return empty collection",
    "",
    "Examples from spec:",
    "  5 mod 2 = 1 (5 = 2*2 + 1)",
    "  5.5 mod 0.7 = 0.6 (5.5 = 7*0.7 + 0.6)",
    "  5 mod 0 = {} (empty, not error)",
    "",
    "=== & (String Concatenation) ===",
    "Concatenates two strings, treating empty as empty string.",
    "This differs from + on strings which returns empty if either operand is empty.",
    "",
    "Key difference from string + operator:",
    "  'ABC' + {} + 'DEF' = {} (+ propagates empty)",
    "  'ABC' & {} & 'DEF' = 'ABCDEF' (& treats empty as '')",
    "",
    "This is specifically designed for string building where missing values",
    "should be treated as empty strings rather than causing the whole expression",
    "to return empty.",
    "",
    "Type handling:",
    "  - Both operands must be strings (or collections that evaluate to strings)",
    "  - Multiple items in operand: behavior is implementation-specific",
    "    (official test shows (1|2|3) & 'b' = '1,2,3b' suggesting join-like behavior)",
    "",
    "=== Empty Collection Behavior ===",
    "For div and mod:",
    "  - If either operand is empty, result is empty",
    "  - Division/modulo by zero returns empty (not error)",
    "",
    "For &:",
    "  - Empty operand treated as empty string",
    "  - Never returns empty due to empty operand"
  ],
  "_todo": [
    "[x] Improve passing rate (36/36 passing)",
    "[x] Verified against spec §div, §mod, §& (string concatenation) sections",
    "[ ] Verify decimal div/mod precision handling - floating point precision issues require ~ instead of =",
    "[ ] Test negative number truncation behavior (toward zero, not toward -infinity)",
    "[ ] Add tests for multi-item collection in & (if specification clarifies)",
    "[ ] Note: decimal div returns Decimal type, not Integer - matches R5 equality tests"
  ],
  "meta": {
    "status": "reviewed"
  },
  "cases": [
    {
      "_section": "=== DIV OPERATOR - INTEGERS ==="
    },
    {
      "name": "div: 1 div 1 equals 1",
      "expr": "1 div 1",
      "input": {},
      "expect": [{"type": "integer", "value": 1}]
    },
    {
      "name": "div: 4 div 2 equals 2",
      "expr": "4 div 2",
      "input": {},
      "expect": [{"type": "integer", "value": 2}]
    },
    {
      "name": "div: 5 div 2 truncates to 2",
      "expr": "5 div 2",
      "input": {},
      "expect": [{"type": "integer", "value": 2}],
      "comment": "5/2=2.5, truncated to 2"
    },
    {
      "name": "div: 7 div 3 truncates to 2",
      "expr": "7 div 3",
      "input": {},
      "expect": [{"type": "integer", "value": 2}],
      "comment": "7/3=2.33..., truncated to 2"
    },
    {
      "name": "div: 10 div 3 truncates to 3",
      "expr": "10 div 3",
      "input": {},
      "expect": [{"type": "integer", "value": 3}],
      "comment": "10/3=3.33..., truncated to 3"
    },
    {
      "name": "div: division by zero returns empty",
      "expr": "(5 div 0).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Per spec: 5 div 0 = {}"
    },
    {
      "_section": "=== DIV OPERATOR - DECIMALS ==="
    },
    {
      "name": "div: 2.2 div 1.8 truncates to 1",
      "expr": "2.2 div 1.8 = 1",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "2.2/1.8=1.22..., truncated to 1; use equality check per R5 test pattern"
    },
    {
      "name": "div: 5.5 div 0.7 truncates to 7",
      "expr": "5.5 div 0.7 = 7",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Spec example: 5.5/0.7=7.857..., truncated to 7"
    },
    {
      "name": "div: 10.0 div 3.0 truncates to 3",
      "expr": "10.0 div 3.0 = 3",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "_section": "=== DIV OPERATOR - EMPTY HANDLING ==="
    },
    {
      "name": "div: left empty returns empty",
      "expr": "({} div 1).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "div: right empty returns empty",
      "expr": "(1 div {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "div: both empty returns empty",
      "expr": "({} div {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "_section": "=== MOD OPERATOR - INTEGERS ==="
    },
    {
      "name": "mod: 1 mod 1 equals 0",
      "expr": "1 mod 1",
      "input": {},
      "expect": [{"type": "integer", "value": 0}]
    },
    {
      "name": "mod: 4 mod 2 equals 0",
      "expr": "4 mod 2",
      "input": {},
      "expect": [{"type": "integer", "value": 0}]
    },
    {
      "name": "mod: 5 mod 2 equals 1",
      "expr": "5 mod 2",
      "input": {},
      "expect": [{"type": "integer", "value": 1}],
      "comment": "5 = 2*2 + 1"
    },
    {
      "name": "mod: 7 mod 3 equals 1",
      "expr": "7 mod 3",
      "input": {},
      "expect": [{"type": "integer", "value": 1}],
      "comment": "7 = 2*3 + 1"
    },
    {
      "name": "mod: 10 mod 3 equals 1",
      "expr": "10 mod 3",
      "input": {},
      "expect": [{"type": "integer", "value": 1}],
      "comment": "10 = 3*3 + 1"
    },
    {
      "name": "mod: modulo by zero returns empty",
      "expr": "(5 mod 0).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Per spec: 5 mod 0 = {}"
    },
    {
      "_section": "=== MOD OPERATOR - DECIMALS ==="
    },
    {
      "name": "mod: 2.2 mod 1.8 approximately equals 0.4",
      "expr": "2.2 mod 1.8 ~ 0.4",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "2.2 = 1*1.8 + 0.4; use equivalence to handle floating point precision"
    },
    {
      "name": "mod: 5.5 mod 0.7 approximately equals 0.6",
      "expr": "5.5 mod 0.7 ~ 0.6",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Spec example: 5.5 = 7*0.7 + 0.6; use equivalence for floating point"
    },
    {
      "_section": "=== MOD OPERATOR - EMPTY HANDLING ==="
    },
    {
      "name": "mod: left empty returns empty",
      "expr": "({} mod 1).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "mod: right empty returns empty",
      "expr": "(1 mod {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "mod: both empty returns empty",
      "expr": "({} mod {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "_section": "=== STRING CONCATENATION & OPERATOR ==="
    },
    {
      "name": "&: basic concatenation",
      "expr": "'a' & 'b'",
      "input": {},
      "expect": [{"type": "string", "value": "ab"}],
      "comment": "Simple string concatenation"
    },
    {
      "name": "&: longer strings",
      "expr": "'ABC' & 'DEF'",
      "input": {},
      "expect": [{"type": "string", "value": "ABCDEF"}]
    },
    {
      "name": "&: left empty treated as empty string",
      "expr": "{} & 'b'",
      "input": {},
      "expect": [{"type": "string", "value": "b"}],
      "comment": "Empty is treated as ''"
    },
    {
      "name": "&: right empty treated as empty string",
      "expr": "'a' & {}",
      "input": {},
      "expect": [{"type": "string", "value": "a"}],
      "comment": "Empty is treated as ''"
    },
    {
      "name": "&: chained with empty in middle",
      "expr": "'ABC' & {} & 'DEF'",
      "input": {},
      "expect": [{"type": "string", "value": "ABCDEF"}],
      "comment": "Spec example: middle empty treated as ''"
    },
    {
      "name": "&: empty strings",
      "expr": "'' & ''",
      "input": {},
      "expect": [{"type": "string", "value": ""}]
    },
    {
      "name": "&: both operands empty collections",
      "expr": "{} & {}",
      "input": {},
      "expect": [{"type": "string", "value": ""}],
      "comment": "Both empty treated as '', result is ''"
    },
    {
      "_section": "=== COMPARISON: + vs & FOR STRINGS ==="
    },
    {
      "name": "+: string concat with empty returns empty",
      "expr": "('ABC' + {} + 'DEF').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Spec: + on strings returns empty if any operand is empty"
    },
    {
      "name": "&: string concat with empty returns concatenated result",
      "expr": "'ABC' & {} & 'DEF'",
      "input": {},
      "expect": [{"type": "string", "value": "ABCDEF"}],
      "comment": "Spec: & treats empty as '' so result is 'ABCDEF'"
    },
    {
      "_section": "=== PATH-BASED OPERATIONS ==="
    },
    {
      "name": "div: from path values",
      "expr": "a div b = 3",
      "input": {"a": 10, "b": 3},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "mod: from path values",
      "expr": "a mod b = 1",
      "input": {"a": 10, "b": 3},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "&: from path values",
      "expr": "first & ' ' & last",
      "input": {"first": "John", "last": "Doe"},
      "expect": [{"type": "string", "value": "John Doe"}]
    },
    {
      "name": "&: missing path treated as empty",
      "expr": "first & ' ' & middle & ' ' & last",
      "input": {"first": "John", "last": "Doe"},
      "expect": [{"type": "string", "value": "John  Doe"}],
      "comment": "middle is empty, treated as '', results in double space"
    }
  ]
}
