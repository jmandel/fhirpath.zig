{
  "_spec_summary": [
    "## Quantity Arithmetic (Spec §6.6 Math Operators, §6.7 Date/Time Arithmetic)",
    "",
    "### Core behavior (spec lines 2935-2939)",
    "The math operators (+, -, *, /) work on Quantity values in addition to Integer and Decimal.",
    "Each operand must be a single element. If there is more than one item or an incompatible item,",
    "the evaluation signals an error. If one or both operands are empty, the result is empty.",
    "",
    "### Addition and Subtraction with Quantities (spec lines 2973-2991)",
    "When adding or subtracting quantities, the dimensions of each quantity must be the same,",
    "but not necessarily the unit. For example, units of 'cm' and 'm' can be added.",
    "The result unit will be the most granular unit of either input:",
    "  3 'm' + 3 'cm' → 303 'cm'",
    "  3 'm' - 3 'cm' → 297 'cm'",
    "",
    "### Multiplication and Division with Quantities (spec lines 2951-2972)",
    "Multiplication creates derived units per UCUM:",
    "  12 'cm' * 3 'cm' → 36 'cm2'",
    "  3 'cm' * 12 'cm2' → 36 'cm3'",
    "Division also creates derived units:",
    "  12 'cm2' / 3 'cm' → 4.0 'cm'",
    "Division of same-unit quantities produces a dimensionless Decimal (units cancel per UCUM).",
    "Note: 'The result of a division is always Decimal' (spec line 2962).",
    "",
    "### Division by zero (spec line 2964)",
    "If an attempt is made to divide by zero, the result is empty ({}).",
    "",
    "### Unit handling (spec lines 2941-2947)",
    "Implementations are not required to fully support operations on units, but they must at",
    "least respect units, recognizing when units differ.",
    "Attempting to operate on quantities with invalid or 'special' units results in empty ({}).",
    "Implementations that do support units shall do so per UCUM.",
    "",
    "### Same-unit arithmetic",
    "When both quantities have the same unit, arithmetic is straightforward:",
    "the values are operated on and the unit is preserved (for + and -).",
    "",
    "### Calendar duration quantities (spec lines 387-416, 2569-2640)",
    "Calendar duration keywords (year, month, week, day, hour, minute, second, millisecond)",
    "can be used in quantity expressions.",
    "",
    "Calendar vs UCUM definite duration comparison rules:",
    "- Above days (year, month, week, day): calendar durations are UN-EQUAL to UCUM equivalents",
    "  (1 year = 1 'a' → {} empty), but EQUIVALENT (1 year ~ 1 'a' → true)",
    "- At/below seconds: calendar durations EQUAL their UCUM equivalents",
    "  (1 second = 1 's' → true, 1 millisecond = 1 'ms' → true)",
    "",
    "Unit representation for calendar durations (spec line 390-400):",
    "  year/years → 'year', month/months → 'month', week/weeks → 'week', etc.",
    "",
    "### Empty collection propagation (spec line 2939)",
    "As with all math operators, if one or both operands are empty, the result is empty.",
    "",
    "### Overflow/Underflow (spec line 2949)",
    "Operations that cause arithmetic overflow or underflow result in empty ({}).",
    "",
    "### Special UCUM units (spec lines 2942-2943)",
    "Non-ratio scale 'Special' UCUM units (e.g., Fahrenheit degF, Celsius Cel) cannot be used",
    "in arithmetic operations; the result is empty ({})."
  ],
  "_todo": [
    "[ ] Improve passing rate (55/59 passing)",
    "[ ] Implement calendar-to-UCUM duration equivalence (1 year ~ 1 'a' → true)",
    "[ ] Implement calendar-to-UCUM duration equality (1 second = 1 's' → true)",
    "[x] Spec-verified: all 59 test expectations are correct per spec",
    "[ ] Add cross-unit arithmetic tests once UCUM conversion is supported",
    "[ ] Add overflow/underflow edge cases for very large quantity values",
    "[ ] Verify calendar duration arithmetic with Date/DateTime operands"
  ],
  "meta": {
    "status": "reviewed"
  },
  "cases": [
    {
      "name": "add: same unit integers",
      "expr": "10 'mg' + 5 'mg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 15, "unit": "mg"}}]
    },
    {
      "name": "add: same unit decimals",
      "expr": "1.5 'kg' + 2.3 'kg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 3.8, "unit": "kg"}}]
    },
    {
      "name": "add: same unit with zero",
      "expr": "0 'cm' + 5 'cm'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 5, "unit": "cm"}}]
    },
    {
      "name": "subtract: same unit integers",
      "expr": "10 'mg' - 3 'mg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 7, "unit": "mg"}}]
    },
    {
      "name": "subtract: same unit resulting in zero",
      "expr": "5 'cm' - 5 'cm'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 0, "unit": "cm"}}]
    },
    {
      "name": "subtract: same unit resulting in negative",
      "expr": "3 'kg' - 5 'kg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": -2, "unit": "kg"}}]
    },
    {
      "name": "subtract: same unit decimals",
      "expr": "10.5 'mL' - 3.2 'mL'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 7.3, "unit": "mL"}}]
    },
    {
      "name": "multiply: quantity by integer",
      "expr": "5 'mg' * 3",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 15, "unit": "mg"}}]
    },
    {
      "name": "multiply: integer by quantity",
      "expr": "3 * 5 'mg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 15, "unit": "mg"}}]
    },
    {
      "name": "multiply: quantity by decimal",
      "expr": "5 'mg' * 2.5",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 12.5, "unit": "mg"}}]
    },
    {
      "name": "multiply: quantity by zero",
      "expr": "5 'mg' * 0",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 0, "unit": "mg"}}]
    },
    {
      "name": "divide: quantity by integer",
      "expr": "10 'mg' / 2",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 5.0, "unit": "mg"}}],
      "comment": "Division always produces decimal values"
    },
    {
      "name": "divide: quantity by decimal",
      "expr": "10 'mg' / 2.5",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 4.0, "unit": "mg"}}]
    },
    {
      "name": "divide: quantity by zero returns empty",
      "expr": "(10 'mg' / 0).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Division by zero returns empty collection"
    },
    {
      "name": "add: empty left operand returns empty",
      "expr": "({} + 5 'mg').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "add: empty right operand returns empty",
      "expr": "(5 'mg' + {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "subtract: empty left operand returns empty",
      "expr": "({} - 5 'mg').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "subtract: empty right operand returns empty",
      "expr": "(5 'mg' - {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "multiply: empty left operand returns empty",
      "expr": "({} * 5 'mg').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "multiply: empty right operand returns empty",
      "expr": "(5 'mg' * {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "divide: empty left operand returns empty",
      "expr": "({} / 5 'mg').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "divide: empty right operand returns empty",
      "expr": "(5 'mg' / {}).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "add: calendar duration same unit",
      "expr": "2 days + 3 days",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 5, "unit": "day"}}]
    },
    {
      "name": "subtract: calendar duration same unit",
      "expr": "5 days - 2 days",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 3, "unit": "day"}}]
    },
    {
      "name": "add: calendar duration hours",
      "expr": "3 hours + 2 hours",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 5, "unit": "hour"}}]
    },
    {
      "name": "add: calendar duration minutes",
      "expr": "30 minutes + 15 minutes",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 45, "unit": "minute"}}]
    },
    {
      "name": "add: calendar duration years",
      "expr": "1 year + 2 years",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 3, "unit": "year"}}],
      "comment": "Result unit uses left operand's form (singular); both singular/plural are equivalent"
    },
    {
      "name": "add: calendar duration months",
      "expr": "6 months + 3 months",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 9, "unit": "month"}}]
    },
    {
      "name": "add: calendar duration weeks",
      "expr": "2 weeks + 1 week",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 3, "unit": "week"}}]
    },
    {
      "name": "add: different units returns empty (incompatible dimensions)",
      "expr": "(10 'mg' + 5 'cm').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Different dimensions (mass vs length) cannot be added"
    },
    {
      "name": "subtract: different units returns empty (incompatible dimensions)",
      "expr": "(10 'mg' - 5 'cm').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Different dimensions (mass vs length) cannot be subtracted"
    },
    {
      "name": "add: different calendar durations returns empty",
      "expr": "(1 year + 1 day).empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Cannot add calendar durations of different types (year + day)"
    },
    {
      "name": "multiply: two quantities (unit multiplication)",
      "expr": "12 'cm' * 3 'cm'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 36, "unit": "cm2"}}],
      "comment": "Spec example: multiplying same-unit quantities produces squared units"
    },
    {
      "name": "divide: derived unit by base unit",
      "expr": "12 'cm2' / 3 'cm'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 4.0, "unit": "cm"}}],
      "comment": "Spec example: dividing squared by base unit gives base unit"
    },
    {
      "name": "divide: same unit quantities (dimensionless result)",
      "expr": "10 'mg' / 5 'mg'",
      "input": {},
      "expect": [{"type": "decimal", "value": 2.0}],
      "comment": "Dividing same-unit quantities produces a dimensionless decimal"
    },
    {
      "name": "add: negative quantity values",
      "expr": "(-3 'mg') + (-2 'mg')",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": -5, "unit": "mg"}}]
    },
    {
      "name": "multiply: negative quantity",
      "expr": "(-5 'mg') * 3",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": -15, "unit": "mg"}}]
    },
    {
      "name": "multiply: quantity by negative number",
      "expr": "5 'mg' * (-3)",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": -15, "unit": "mg"}}]
    },
    {
      "name": "divide: negative quantity",
      "expr": "(-10 'mg') / 2",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": -5.0, "unit": "mg"}}]
    },
    {
      "name": "add: quantity with decimal value",
      "expr": "1.5 'mg' + 2.5 'mg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 4.0, "unit": "mg"}}]
    },
    {
      "name": "multiply: quantity with decimal result",
      "expr": "7 'mg' * 0.5",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 3.5, "unit": "mg"}}]
    },
    {
      "name": "add: seconds as calendar duration",
      "expr": "30 seconds + 15 seconds",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 45, "unit": "second"}}]
    },
    {
      "name": "add: milliseconds as calendar duration",
      "expr": "500 milliseconds + 250 milliseconds",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 750, "unit": "millisecond"}}]
    },
    {
      "name": "equality: same unit same value",
      "expr": "10 'mg' = 10 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "equality: same unit different value",
      "expr": "10 'mg' = 5 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": false}]
    },
    {
      "name": "equality: calendar duration equal",
      "expr": "1 day = 1 day",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "equality: calendar vs UCUM duration returns empty for incomparable",
      "expr": "(1 year = 1 'a').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Spec: calendar durations and definite durations above days are un-comparable"
    },
    {
      "name": "equivalence: calendar vs UCUM duration returns true",
      "expr": "1 year ~ 1 'a'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Spec: for equivalence, calendar and definite durations are considered equivalent"
    },
    {
      "name": "equivalence: second calendar vs UCUM",
      "expr": "1 second ~ 1 's'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "equality: second calendar vs UCUM",
      "expr": "1 second = 1 's'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Seconds and below are both calendar and definite, so they are comparable"
    },
    {
      "name": "comparison: same unit greater than",
      "expr": "10 'mg' > 5 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "comparison: same unit less than",
      "expr": "5 'mg' < 10 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "comparison: same unit greater or equal (equal)",
      "expr": "10 'mg' >= 10 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "comparison: same unit less or equal (equal)",
      "expr": "10 'mg' <= 10 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "comparison: different dimensions returns empty",
      "expr": "(10 'mg' > 5 'cm').empty()",
      "input": {},
      "expect": [{"type": "boolean", "value": true}],
      "comment": "Cannot compare quantities of different dimensions"
    },
    {
      "name": "add: chain of additions",
      "expr": "1 'mg' + 2 'mg' + 3 'mg'",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 6, "unit": "mg"}}]
    },
    {
      "name": "multiply: chain with scalar",
      "expr": "5 'mg' * 2 * 3",
      "input": {},
      "expect": [{"type": "Quantity", "value": {"value": 30, "unit": "mg"}}]
    },
    {
      "name": "mixed: add then compare",
      "expr": "(5 'mg' + 5 'mg') = 10 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    },
    {
      "name": "mixed: multiply then compare",
      "expr": "(5 'mg' * 2) > 9 'mg'",
      "input": {},
      "expect": [{"type": "boolean", "value": true}]
    }
  ]
}
