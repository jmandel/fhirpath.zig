{
  "meta": {
    "status": "reviewed",
    "_spec_summary": [
      "=== OVERVIEW ===",
      "Type conversion functions transform values between FHIRPath types.",
      "Two patterns:",
      "  - toX(): Performs conversion, returns empty if not convertible",
      "  - convertsToX(): Returns boolean indicating if conversion would succeed",
      "",
      "=== SINGLETON REQUIREMENT ===",
      "All conversion functions require singleton input (0 or 1 items).",
      "Multiple items \u2192 evaluation ends with an error signal to calling environment.",
      "Empty input \u2192 empty result (for BOTH toX and convertsToX).",
      "",
      "=== toBoolean() ===",
      "Converts to Boolean if input is:",
      "  - Boolean: passthrough",
      "  - String: case-insensitive match to specific values:",
      "      true:  'true', 't', 'yes', 'y', '1', '1.0'",
      "      false: 'false', 'f', 'no', 'n', '0', '0.0'",
      "      other strings \u2192 empty",
      "  - Integer: 1\u2192true, 0\u2192false, other integers\u2192empty",
      "  - Decimal: 1.0 (or decimal equivalent like 1.00)\u2192true, 0.0 (or equivalent)\u2192false, others\u2192empty",
      "Other types \u2192 empty",
      "",
      "=== toInteger() ===",
      "Converts to Integer if input is:",
      "  - Integer: passthrough",
      "  - String: must match regex (\\+|-)?\\d+ (NO decimal point allowed!)",
      "      '42'\u219242, '-17'\u2192-17, '+5'\u21925",
      "      '1.0'\u2192empty (decimal format not allowed)",
      "      'abc'\u2192empty",
      "  - Boolean: true\u21921, false\u21920",
      "Other types \u2192 empty",
      "",
      "=== toDecimal() ===",
      "Converts to Decimal if input is:",
      "  - Integer or Decimal: passthrough (Integer promoted to Decimal)",
      "  - String: must match regex (\\+|-)?\\d+(\\.\\d+)?",
      "      '3.14'\u21923.14, '42'\u219242, '-0.5'\u2192-0.5",
      "      '1.a'\u2192empty",
      "  - Boolean: true\u21921.0, false\u21920.0",
      "Other types \u2192 empty",
      "",
      "=== toString() ===",
      "Converts to String. Nearly all primitive types convert:",
      "  - String: passthrough",
      "  - Boolean: 'true' or 'false'",
      "  - Integer: standard representation, e.g., 42\u2192'42', -1\u2192'-1'",
      "  - Decimal: preserves precision, e.g., 1.0\u2192'1.0', 3.14\u2192'3.14'",
      "  - Quantity: value + unit, UCUM units quoted: 53 'km'\u2192\"53 'km'\", calendar unquoted: 4 days\u2192'4 days'",
      "  - Date: YYYY-MM-DD without @ prefix, e.g., @2020-01-01\u2192'2020-01-01'",
      "  - DateTime: full ISO format without @ prefix, preserves precision",
      "  - Time: hh:mm:ss.fff without @T prefix, e.g., @T10:30\u2192'10:30'",
      "Other types \u2192 empty",
      "",
      "=== toQuantity([unit]) ===",
      "Converts to Quantity if input is:",
      "  - Integer or Decimal: value with default unit '1'",
      "  - Quantity: passthrough (or converted if unit arg provided)",
      "  - String: parsed via regex (?'value'(\\+|-)?\\d+(\\.\\d+)?)\\s*('(?'unit'[^']+)'|(?'time'[a-zA-Z]+))?",
      "      '4 days'\u21924 days (calendar duration)",
      "      '10 \\'kg\\''\u219210 'kg' (UCUM unit with quotes)",
      "      '1.0'\u21921.0 '1'",
      "      'abc'\u2192empty",
      "  - Boolean: true\u21921.0 '1', false\u21920.0 '1'",
      "Optional unit argument: UCUM code for conversion. If conversion not supported, returns empty.",
      "Calendar duration conversions: 1 year=12 months=365 days, 1 month=30 days, 1 day=24 hours, etc.",
      "",
      "=== toDate() ===",
      "Converts to Date if input is:",
      "  - Date: passthrough",
      "  - DateTime: extracts year/month/day WITHOUT timezone conversion",
      "  - String: format YYYY-MM-DD (partial dates allowed: YYYY, YYYY-MM)",
      "      '2024-01-15'\u2192@2024-01-15, '2024-01'\u2192@2024-01, '2024'\u2192@2024",
      "Other types \u2192 empty",
      "",
      "=== toDateTime() ===",
      "Converts to DateTime if input is:",
      "  - DateTime: passthrough",
      "  - Date: promoted to DateTime (time components empty, not set to zero)",
      "  - String: ISO format YYYY-MM-DDThh:mm:ss.fff(+|-)hh:mm (partial allowed)",
      "Partial datetimes are preserved as partial.",
      "",
      "=== toTime() ===",
      "Converts to Time if input is:",
      "  - Time: passthrough",
      "  - String: format hh:mm:ss.fff (partial times allowed: hh, hh:mm)",
      "      '14'\u2192@T14, '14:34'\u2192@T14:34, '14:34:28.123'\u2192@T14:34:28.123",
      "Other types \u2192 empty",
      "",
      "=== toLong() (STU) ===",
      "Like toInteger but for 64-bit integers.",
      "Same conversion rules, larger range.",
      "",
      "=== SURPRISING BEHAVIORS ===",
      "1. toInteger rejects decimal strings: '1.0'.toInteger() \u2192 empty",
      "2. toBoolean only accepts specific string values, not any truthy/falsy",
      "3. Decimal equivalent: 1.00 and 1.0 both convert to true via toBoolean",
      "4. toString on Date/DateTime/Time removes the @ prefix",
      "5. toQuantity string parsing requires UCUM units to be quoted: '1 \\'kg\\'' not '1 kg'",
      "6. convertsToX returns empty (not false) when input is empty"
    ],
    "_todo": [
      "[ ] Improve passing rate (47/119 passing, 16 blocked by parser)",
      "[x] Implement toBoolean/toInteger conversion functions",
      "[ ] Implement conversion functions (toDecimal, toString, toQuantity, toDate, toDateTime, toTime)",
      "[x] Implement convertsToBoolean/convertsToInteger",
      "[ ] Implement remaining convertsToX boolean checker functions",
      "[ ] Parser: support parenthesized expressions like (-1)",
      "[ ] Parser: support method calls on date/time literals like @2024-01-15.toString()",
      "[ ] Parser: support method calls on quantity literals like (10 'mg').toString()",
      "[ ] Add toLong/convertsToLong tests (STU feature)",
      "[ ] Test numeric range limits (overflow behavior)",
      "[ ] Add toQuantity(unit) UCUM conversion tests",
      "[x] Add tests for DateTime\u2192toDate extraction (added, parser-blocked)",
      "[x] Add tests for Date\u2192toDateTime promotion (added, parser-blocked)",
      "[x] Add toString tests for Date/DateTime/Time (added, parser-blocked)",
      "[x] Verify toTime accepts partial times (hour-only, hour:minute) per official tests",
      "[x] Verify toDate accepts partial dates per official tests",
      "[x] Cross-check all string representations against spec"
    ],
    "_open_questions": [
      "RESOLVED: toQuantity with unsupported unit conversion returns empty per spec.",
      "RESOLVED: Decimal equivalents (1.0, 1.00) all convert to true - spec says 'decimal equivalent'.",
      "Q: Should convertsToTime('14') be true? Official tests say YES (hour-only partial time)."
    ]
  },
  "cases": [
    {
      "name": "toBoolean: string 'true'",
      "expr": "'true'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string 'false'",
      "expr": "'false'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: string 't' (case insensitive)",
      "expr": "'t'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string 'T' (uppercase)",
      "expr": "'T'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string 'yes'",
      "expr": "'yes'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string 'YES' (case insensitive)",
      "expr": "'YES'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string 'y'",
      "expr": "'y'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string '1'",
      "expr": "'1'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string '1.0'",
      "expr": "'1.0'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: string 'f'",
      "expr": "'f'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: string 'no'",
      "expr": "'no'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: string 'n'",
      "expr": "'n'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: string '0'",
      "expr": "'0'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: string '0.0'",
      "expr": "'0.0'.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: string 'invalid' returns empty",
      "expr": "'invalid'.toBoolean()",
      "input": {},
      "expect": []
    },
    {
      "name": "toBoolean: integer 1",
      "expr": "1.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: integer 0",
      "expr": "0.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: integer 2 returns empty",
      "expr": "2.toBoolean()",
      "input": {},
      "expect": []
    },
    {
      "name": "toBoolean: integer -1 returns empty",
      "expr": "(-1).toBoolean()",
      "input": {},
      "expect": [],
      "skip": "Parser: parenthesized expressions not supported"
    },
    {
      "name": "toBoolean: decimal 1.0",
      "expr": "1.0.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: decimal 0.0",
      "expr": "0.0.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: decimal 1.5 returns empty",
      "expr": "1.5.toBoolean()",
      "input": {},
      "expect": []
    },
    {
      "name": "toBoolean: boolean passthrough true",
      "expr": "true.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toBoolean: boolean passthrough false",
      "expr": "false.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "toBoolean: empty input returns empty",
      "expr": "{}.toBoolean()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToBoolean: string 'true'",
      "expr": "'true'.convertsToBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToBoolean: string 'invalid'",
      "expr": "'invalid'.convertsToBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToBoolean: integer 1",
      "expr": "1.convertsToBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToBoolean: integer 2 (not convertible)",
      "expr": "2.convertsToBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToBoolean: decimal 1.0",
      "expr": "1.0.convertsToBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToBoolean: empty returns empty",
      "expr": "{}.convertsToBoolean()",
      "input": {},
      "expect": []
    },
    {
      "name": "toInteger: string '42'",
      "expr": "'42'.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 42
        }
      ]
    },
    {
      "name": "toInteger: string '-17'",
      "expr": "'-17'.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": -17
        }
      ]
    },
    {
      "name": "toInteger: string '+5'",
      "expr": "'+5'.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 5
        }
      ]
    },
    {
      "name": "toInteger: string '0'",
      "expr": "'0'.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 0
        }
      ]
    },
    {
      "name": "toInteger: string '1.0' returns empty (decimal not convertible)",
      "expr": "'1.0'.toInteger()",
      "input": {},
      "expect": []
    },
    {
      "name": "toInteger: string 'abc' returns empty",
      "expr": "'abc'.toInteger()",
      "input": {},
      "expect": []
    },
    {
      "name": "toInteger: integer passthrough",
      "expr": "42.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 42
        }
      ]
    },
    {
      "name": "toInteger: boolean true",
      "expr": "true.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 1
        }
      ]
    },
    {
      "name": "toInteger: boolean false",
      "expr": "false.toInteger()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 0
        }
      ]
    },
    {
      "name": "toInteger: empty returns empty",
      "expr": "{}.toInteger()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToInteger: string '42'",
      "expr": "'42'.convertsToInteger()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToInteger: string '1.0' (not convertible)",
      "expr": "'1.0'.convertsToInteger()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToInteger: string 'abc' (not convertible)",
      "expr": "'abc'.convertsToInteger()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToInteger: integer always true",
      "expr": "42.convertsToInteger()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToInteger: boolean always true",
      "expr": "true.convertsToInteger()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToInteger: empty returns empty",
      "expr": "{}.convertsToInteger()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDecimal: string '3.14'",
      "expr": "'3.14'.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": 3.14
        }
      ]
    },
    {
      "name": "toDecimal: string '-0.5'",
      "expr": "'-0.5'.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": -0.5
        }
      ]
    },
    {
      "name": "toDecimal: string '42' (integer format ok)",
      "expr": "'42'.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 42
        }
      ]
    },
    {
      "name": "toDecimal: string 'abc' returns empty",
      "expr": "'abc'.toDecimal()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDecimal: string '1.a' returns empty",
      "expr": "'1.a'.toDecimal()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDecimal: integer promotes to decimal",
      "expr": "42.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": 42.0
        }
      ]
    },
    {
      "name": "toDecimal: decimal passthrough",
      "expr": "3.14.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": 3.14
        }
      ]
    },
    {
      "name": "toDecimal: boolean true",
      "expr": "true.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": 1.0
        }
      ]
    },
    {
      "name": "toDecimal: boolean false",
      "expr": "false.toDecimal()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": 0.0
        }
      ]
    },
    {
      "name": "toDecimal: empty returns empty",
      "expr": "{}.toDecimal()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToDecimal: string '3.14'",
      "expr": "'3.14'.convertsToDecimal()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToDecimal: string 'abc'",
      "expr": "'abc'.convertsToDecimal()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToDecimal: integer always true",
      "expr": "42.convertsToDecimal()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToDecimal: boolean always true",
      "expr": "true.convertsToDecimal()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToDecimal: empty returns empty",
      "expr": "{}.convertsToDecimal()",
      "input": {},
      "expect": []
    },
    {
      "name": "toString: integer",
      "expr": "42.toString()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": 42
        }
      ]
    },
    {
      "name": "toString: negative integer",
      "expr": "(-1).toString()",
      "input": {},
      "expect": [
        {
          "type": "integer",
          "value": -1
        }
      ],
      "skip": "Parser: parenthesized expressions not supported"
    },
    {
      "name": "toString: decimal",
      "expr": "3.14.toString()",
      "input": {},
      "expect": [
        {
          "type": "decimal",
          "value": 3.14
        }
      ]
    },
    {
      "name": "toString: decimal 1.0 preserves precision",
      "expr": "1.0.toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "1.0"
        }
      ],
      "_adjudicated": {
        "fhirpath_js": [
          {
            "type": "string",
            "value": "1"
          }
        ],
        "our_old_value": [
          {
            "type": "decimal",
            "value": 1.0
          }
        ],
        "verdict": "ours_correct",
        "reason": "The toString() specification defines the Decimal representation as (-)?#0.0#, and the official R5 tests assert 1.0.toString() yields \"1.0\". This preserves at least one fractional digit; dropping the trailing zero (\"1\") is not spec-conformant.",
        "spec_ref": "String Conversion Functions — toString()"
      }
    },
    {
      "name": "toString: boolean true",
      "expr": "true.toString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "toString: boolean false",
      "expr": "false.toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "false"
        }
      ],
      "_adjudicated": {
        "fhirpath_js": [
          {
            "type": "string",
            "value": "false"
          }
        ],
        "our_old_value": [
          {
            "type": "boolean",
            "value": false
          }
        ],
        "verdict": "theirs_correct",
        "reason": "The toString() spec states Boolean values convert to the strings \"true\" and \"false\"; therefore the result is a string, not a Boolean.",
        "spec_ref": "String Conversion Functions — toString()"
      }
    },
    {
      "name": "toString: string passthrough",
      "expr": "'hello'.toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "hello"
        }
      ]
    },
    {
      "name": "toString: empty returns empty",
      "expr": "{}.toString()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToString: integer",
      "expr": "42.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToString: decimal",
      "expr": "3.14.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToString: boolean",
      "expr": "true.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToString: string",
      "expr": "'hello'.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToString: empty returns empty",
      "expr": "{}.convertsToString()",
      "input": {},
      "expect": []
    },
    {
      "name": "toQuantity: integer becomes quantity with unit '1'",
      "expr": "42.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 42,
            "unit": "1"
          }
        }
      ]
    },
    {
      "name": "toQuantity: decimal becomes quantity with unit '1'",
      "expr": "3.14.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 3.14,
            "unit": "1"
          }
        }
      ]
    },
    {
      "name": "toQuantity: string '10 kg'",
      "expr": "'10 \\'kg\\''.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 10,
            "unit": "kg"
          }
        }
      ]
    },
    {
      "name": "toQuantity: string '4 days' (calendar duration)",
      "expr": "'4 days'.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 4,
            "unit": "days"
          }
        }
      ]
    },
    {
      "name": "toQuantity: boolean true",
      "expr": "true.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 1.0,
            "unit": "1"
          }
        }
      ]
    },
    {
      "name": "toQuantity: boolean false",
      "expr": "false.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 0.0,
            "unit": "1"
          }
        }
      ]
    },
    {
      "name": "toQuantity: string 'abc' returns empty",
      "expr": "'abc'.toQuantity()",
      "input": {},
      "expect": []
    },
    {
      "name": "toQuantity: empty returns empty",
      "expr": "{}.toQuantity()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToQuantity: integer",
      "expr": "42.convertsToQuantity()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToQuantity: decimal",
      "expr": "3.14.convertsToQuantity()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToQuantity: string '4 days'",
      "expr": "'4 days'.convertsToQuantity()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToQuantity: string 'abc'",
      "expr": "'abc'.convertsToQuantity()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToQuantity: boolean",
      "expr": "true.convertsToQuantity()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToQuantity: empty returns empty",
      "expr": "{}.convertsToQuantity()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDate: string '2024-01-15'",
      "expr": "'2024-01-15'.toDate()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024-01-15"
        }
      ]
    },
    {
      "name": "toDate: string '2024-01' (partial)",
      "expr": "'2024-01'.toDate()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024-01"
        }
      ]
    },
    {
      "name": "toDate: string '2024' (year only)",
      "expr": "'2024'.toDate()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024"
        }
      ]
    },
    {
      "name": "toDate: string 'invalid' returns empty",
      "expr": "'invalid'.toDate()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDate: empty returns empty",
      "expr": "{}.toDate()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToDate: string '2024-01-15'",
      "expr": "'2024-01-15'.convertsToDate()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToDate: string 'invalid'",
      "expr": "'invalid'.convertsToDate()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToDate: empty returns empty",
      "expr": "{}.convertsToDate()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDateTime: string '2024-01-15T10:30:00'",
      "expr": "'2024-01-15T10:30:00'.toDateTime()",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2024-01-15T10:30:00"
        }
      ]
    },
    {
      "name": "toDateTime: string '2024-01-15' (date promoted)",
      "expr": "'2024-01-15'.toDateTime()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024-01-15"
        }
      ]
    },
    {
      "name": "toDateTime: string 'invalid' returns empty",
      "expr": "'invalid'.toDateTime()",
      "input": {},
      "expect": []
    },
    {
      "name": "toDateTime: empty returns empty",
      "expr": "{}.toDateTime()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToDateTime: string '2024-01-15T10:30:00'",
      "expr": "'2024-01-15T10:30:00'.convertsToDateTime()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToDateTime: string 'invalid'",
      "expr": "'invalid'.convertsToDateTime()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToDateTime: empty returns empty",
      "expr": "{}.convertsToDateTime()",
      "input": {},
      "expect": []
    },
    {
      "name": "toTime: string '10:30:00'",
      "expr": "'10:30:00'.toTime()",
      "input": {},
      "expect": [
        {
          "type": "time",
          "value": "10:30:00"
        }
      ]
    },
    {
      "name": "toTime: string '10:30' (partial)",
      "expr": "'10:30'.toTime()",
      "input": {},
      "expect": [
        {
          "type": "time",
          "value": "10:30"
        }
      ]
    },
    {
      "name": "toTime: string 'invalid' returns empty",
      "expr": "'invalid'.toTime()",
      "input": {},
      "expect": []
    },
    {
      "name": "toTime: empty returns empty",
      "expr": "{}.toTime()",
      "input": {},
      "expect": []
    },
    {
      "name": "convertsToTime: string '10:30:00'",
      "expr": "'10:30:00'.convertsToTime()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ]
    },
    {
      "name": "convertsToTime: string 'invalid'",
      "expr": "'invalid'.convertsToTime()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ]
    },
    {
      "name": "convertsToTime: empty returns empty",
      "expr": "{}.convertsToTime()",
      "input": {},
      "expect": []
    },
    {
      "name": "toTime: hour-only string '14'",
      "expr": "'14'.toTime()",
      "input": {},
      "expect": [
        {
          "type": "time",
          "value": "14"
        }
      ],
      "_note": "Official tests confirm hour-only partial time is valid"
    },
    {
      "name": "toTime: string with milliseconds '10:30:45.123'",
      "expr": "'10:30:45.123'.toTime()",
      "input": {},
      "expect": [
        {
          "type": "time",
          "value": "10:30:45.123"
        }
      ]
    },
    {
      "name": "convertsToTime: hour-only string '14'",
      "expr": "'14'.convertsToTime()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "_note": "Official test testStringHourConvertsToTime confirms this"
    },
    {
      "name": "toDate: DateTime extraction without timezone conversion",
      "expr": "@2024-01-15T23:30:00-05:00.toDate()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024-01-15"
        }
      ],
      "_note": "Spec example: extracts date part directly, no TZ adjustment",
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "convertsToDate: DateTime always true",
      "expr": "@2024-01-15T10:30:00.convertsToDate()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "toDateTime: Date promoted to DateTime",
      "expr": "@2024-01-15.toDateTime()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024-01-15"
        }
      ],
      "_note": "Time components empty (not set to zero), so output is partial",
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "convertsToDateTime: Date always true",
      "expr": "@2024-01-15.convertsToDateTime()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "_adjudicated": {
        "fhirpath_js": [
          {
            "type": "boolean",
            "value": false
          }
        ],
        "our_old_value": null,
        "verdict": "ours_correct",
        "reason": "convertsToDateTime() returns true for Date, DateTime, or string values convertible to DateTime. A Date literal is explicitly included, so @2024-01-15 should yield true.",
        "spec_ref": "DateTime Conversion Functions — convertsToDateTime()"
      },
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "toDateTime: string with partial (year only)",
      "expr": "'2024'.toDateTime()",
      "input": {},
      "expect": [
        {
          "type": "date",
          "value": "2024"
        }
      ],
      "_note": "Partial datetime preserved"
    },
    {
      "name": "toDateTime: string with timezone",
      "expr": "'2024-01-15T10:30:00+05:00'.toDateTime()",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2024-01-15T10:30:00+05:00"
        }
      ]
    },
    {
      "name": "toDateTime: string with Z timezone",
      "expr": "'2024-01-15T10:30:00Z'.toDateTime()",
      "input": {},
      "expect": [
        {
          "type": "dateTime",
          "value": "2024-01-15T10:30:00Z"
        }
      ]
    },
    {
      "name": "toQuantity: quantity passthrough",
      "expr": "(10 'mg').toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 10,
            "unit": "mg"
          }
        }
      ],
      "skip": "Parser: parenthesized expressions not supported"
    },
    {
      "name": "toString: Date removes @ prefix",
      "expr": "@2024-01-15.toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "2024-01-15"
        }
      ],
      "_note": "Spec example: @2020-01-01.toString() returns '2020-01-01' (no @)",
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "toString: DateTime removes @ prefix",
      "expr": "@2024-01-15T10:30:00.toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "2024-01-15T10:30:00"
        }
      ],
      "_note": "Spec: output is ISO format without @ prefix",
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "toString: Time removes @T prefix",
      "expr": "@T10:30:00.toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "10:30:00"
        }
      ],
      "_note": "Spec example: @T10:30:00.000.toString() returns '10:30:00.000'",
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "toString: quantity UCUM unit with quotes",
      "expr": "(53 'km').toString()",
      "input": {},
      "expect": [
        {
          "type": "Quantity",
          "value": {
            "value": 53,
            "unit": "km"
          }
        }
      ],
      "_note": "Spec: UCUM units include quotes in string representation",
      "skip": "Parser: parenthesized expressions not supported"
    },
    {
      "name": "toString: quantity calendar duration without quotes",
      "expr": "(4 days).toString()",
      "input": {},
      "expect": [
        {
          "type": "string",
          "value": "4 days"
        }
      ],
      "_note": "Spec: calendar duration units don't include quotes",
      "skip": "Parser: parenthesized expressions not supported"
    },
    {
      "name": "convertsToString: quantity always true",
      "expr": "(10 'mg').convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "skip": "Parser: parenthesized expressions not supported"
    },
    {
      "name": "convertsToString: Date always true",
      "expr": "@2024-01-15.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "convertsToString: DateTime always true",
      "expr": "@2024-01-15T10:30:00.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "convertsToString: Time always true",
      "expr": "@T10:30:00.convertsToString()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "skip": "Parser: date/time literals cannot have method calls"
    },
    {
      "name": "toBoolean: decimal 1.00 (equivalent to 1.0)",
      "expr": "1.00.toBoolean()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": true
        }
      ],
      "_note": "Spec says 'decimal equivalent' so 1.00 should work like 1.0"
    },
    {
      "name": "toQuantity: string '1 wk' without quotes returns empty",
      "expr": "'1 wk'.toQuantity()",
      "input": {},
      "expect": [],
      "_note": "Official test: '1 wk'.convertsToQuantity().not() - UCUM units must be quoted"
    },
    {
      "name": "toQuantity: string '1 \\'wk\\'' with quotes",
      "expr": "'1 \\'wk\\''.toQuantity()",
      "input": {},
      "expect": [
        {
          "type": "unknown",
          "value": {
            "value": 1,
            "unit": "wk"
          }
        }
      ],
      "_note": "UCUM units require quotes in string format"
    },
    {
      "name": "convertsToQuantity: string '1 wk' without quotes",
      "expr": "'1 wk'.convertsToQuantity()",
      "input": {},
      "expect": [
        {
          "type": "boolean",
          "value": false
        }
      ],
      "_note": "Official test confirms: '1 wk'.convertsToQuantity().not() is true"
    }
  ]
}
