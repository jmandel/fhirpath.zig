# Bug Backlog (YAML)
#
# Format is simple YAML for deterministic parsing by scripts.
# Only single-line values are supported.
#
# Allowed status values (convention): open, in_progress, blocked, resolved, wontfix
# Allowed severity values (convention): low, medium, high, critical

version: 1
bugs:
  - slug: result-nodes-lack-metadata
    status: resolved
    severity: medium
    title: Result nodes lack metadata
    description: Evaluator returns raw std.json.Value with no type_id, source_pos, or data_kind. Blocks zero-copy spans and type-aware ops. See design.md Item layout.
    created: "2026-01-27T08:00:00-06:00"
    updated: "2026-01-27T19:30:00-06:00"
    tags: []
  - slug: artisinal-env-support
    status: resolved
    severity: medium
    title: Artisinal env not supported
    description: Harness ignores env field. Was fixed in 4466e76 but regressed in ea7d2da during harness refactor. Need to re-add env parsing and pass to eval context.
    created: "2026-01-27T08:00:00-06:00"
    updated: 2026-01-27
    tags: []
  - slug: harness-memory-leaks
    status: resolved
    severity: medium
    title: Fix memory leaks in test harness
    description: Harness leaks memory when formatting failure output (valueAlloc not freed). Shows gpa errors on test failures.
    created: "2026-01-27T08:00:00-06:00"
    updated: "2026-01-27T19:15:00-06:00"
    tags: [harness, memory]
  - slug: eval-leaks-intermediate-arraylists-during-harness-runs
    status: resolved
    severity: medium
    title: Eval leaks intermediate ArrayLists during harness runs
    description: Running zig build harness with GPA reports leaks from eval.zig (distinctItems/applySegment) even though eval_result.deinit is called; see stack traces in harness output after failures.
    created: "2026-01-27T08:00:00-06:00"
    updated: "2026-01-27T19:30:00-06:00"
    tags: [memory, eval]
  - slug: harness-comment-only-entries
    status: resolved
    severity: low
    title: Harness counts comment-only entries as failures
    description: Section header entries in artisinal test files (entries with only _comment field) are counted as failures because they lack an expr field. These should be skipped.
    created: 2026-01-27
    updated: 2026-01-27
    tags: [harness]
  - slug: memory-leaks-in-parser-harness
    status: resolved
    severity: medium
    title: Memory leaks in parser/harness
    description: GPA reports memory leaks in parsePrimary (dupe lexeme) and harness (allocPrint)
    created: 2026-01-28
    updated: 2026-01-28
    tags: [parser, harness, memory]
  - slug: boundary-functions
    status: resolved
    severity: high
    title: Implement lowBoundary() and highBoundary() functions
    description: Date/time boundary functions not implemented. ~25 R5 test failures. Spec ยง5.6.5.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, datetime]
  - slug: type-checking-operators
    status: open
    severity: high
    title: Fix is()/as()/ofType() type checking with FHIR types
    description: Type operators return wrong results for FHIR types (Quantity, instant, etc). ~24 R5 failures. Need schema integration.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [types, functions]
  - slug: type-introspection
    status: resolved
    severity: medium
    title: Implement type() function returning namespace/name
    description: type() should return object with .namespace and .name fields. ~7 R5 failures. Spec ยง5.1.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, types]
  - slug: define-variable-scoping
    status: open
    severity: medium
    title: Implement defineVariable() scoping rules
    description: defineVariable() not respecting scope boundaries - should error when accessing vars outside their scope. ~10 R5 failures expecting errors.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, variables]
  - slug: polymorphic-choice-types
    status: open
    severity: high
    title: Support FHIR polymorphic choice types (value[x])
    description: Accessing Observation.value should find valueQuantity/valueString/etc. Observation.valueQuantity should work when value is Quantity. ~8 R5 failures.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [fhir, types]
  - slug: tree-traversal-functions
    status: resolved
    severity: medium
    title: Implement repeat() and descendants() tree traversal
    description: repeat(expr) and descendants() not implemented. ~8 R5 failures. Spec ยง5.2.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions]
  - slug: has-value-function
    status: open
    severity: low
    title: Implement hasValue() for primitive extensions
    description: hasValue() should return false for primitives with only extensions (no actual value). ~4 R5 failures. FHIR-specific.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, fhir]
  - slug: extension-function
    status: open
    severity: medium
    title: Implement extension() function for FHIR extensions
    description: extension(url) should filter to extensions matching the URL. ~6 R5 failures.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, fhir]
  - slug: datetime-comparison-today-now
    status: resolved
    severity: medium
    title: Fix date/datetime comparison with today()/now()
    description: Comparisons like 'birthDate < today()' failing. ~6 R5 failures. May be type coercion issue.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [datetime, comparison]
  - slug: sort-descending
    status: open
    severity: low
    title: Implement sort() with descending (-) modifier
    description: sort(-field) for descending order not implemented. ~2 R5 failures.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions]
  - slug: to-quantity-function
    status: resolved
    severity: low
    title: Implement toQuantity() conversion function
    description: toQuantity() for converting strings/numbers to Quantity. ~4 R5 failures.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, conversion]
  - slug: comparable-function
    status: open
    severity: low
    title: Implement comparable() function
    description: comparable() checks if two quantities can be compared. ~3 R5 failures.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions]
  - slug: conforms-to-function
    status: resolved
    severity: low
    title: Implement conformsTo() for profile validation
    description: conformsTo(url) checks if resource conforms to a profile. ~2 R5 failures. FHIR-specific.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [functions, fhir]
  - slug: children-descendants-return-wrong-types-no-schema-traversal
    status: open
    severity: high
    title: children()/descendants() return wrong types (no schema traversal)
    description: "children() and descendants() call itemFromNode with type_id=0, falling to typeIdForNode heuristic that guesses types from string content. All strings get wrong System.Date/DateTime/Time types instead of FHIR schema types. Fix: use parent type_id + entry.key with schema.childTypeForField, mirroring applySegment."
    created: 2026-01-28
    updated: 2026-01-28
    tags: [types, eval, schema]
  - slug: typeidfornode-string-heuristics-are-too-loose
    status: resolved
    severity: low
    title: typeIdForNode string heuristics are too loose
    description: typeIdForNode guesses string types via isDate (has dash), isDateTime (has T), isTime (has colon). These match normal strings like PleasantVille, VT, 555-1234. Should use proper date/time patterns. Secondary to schema-aware traversal fix but affects no-schema fallback.
    created: 2026-01-28
    updated: 2026-01-28
    tags: [types, eval]
